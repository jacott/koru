#!/usr/bin/env node
// -*- js2 -*-
const path = require('path');
const fs = require('fs');
let program = require('commander');

program
  .command('new [name]')
  .option('--link', 'link to global koru instead of local install')
  .description('create a new application called name')
  .action(load('new'));

program
  .command('test')
  .usage('[-s] [-c] [testModule] [testNamePrefix]')
  .option('-s, --server', 'Only run server tests')
  .option('-c, --client', 'Only run client tests')
  .description('Run tests.')
  .action(load('test'));

const koruPackage = JSON.parse(fs.readFileSync(path.resolve(__dirname, '../package.json')));

program.parse(process.argv);

program && program.help();



function load(command) {
  return function () {
    this.koruVersion = koruPackage.version;
    program = null;
    require('../lib/'+command).apply(this, arguments);
  };
}
