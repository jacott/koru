#!/bin/bash
set -e

branch=test
. `dirname "$0"`/../config/environ.sh

rm -f doc/api-*.json

if [[ $1 = "--nodoc" ]]; then
    shift
else
    export KORUAPI=1
fi

export KORU_PORT=3001

$NODE ./bin/koru test --isolated "$@"

name=$(pwd -P)/doc/api.html
cd app
echo "building html..."
${NODE} --es_staging ../lib/api-to-html.js $branch
echo "ready - file://$name"
